---
title: Analyzing Long Running Operation (SQL Query) Telemetry
description: Learn about analyzing long running operation (SQL Query) in Business Central.  
author: jswymer
ms.topic: conceptual
ms.devlang: al
ms.search.keywords: administration, tenant, admin, environment, sandbox, telemetry
ms.date: 04/01/2021
ms.author: jswymer
---

# Analyzing Long Running Operation (SQL Query) Telemetry

[!INCLUDE[azure-ad-to-microsoft-entra-id](~/../shared-content/shared/azure-ad-to-microsoft-entra-id.md)]

Any SQL query that takes longer than 750 milliseconds to execute will be sent to your Azure Application Insights resource. This enables you to focus on tuning SQL queries that take too long to execute (maybe one or more tables miss an index or maybe some filters are missing). It also reduces the ingestion of data into the Azure Application Insights resource to save cost of having telemetry.

If you want to capture all SQL queries for a short period of time for a given session, you can enable **Additional logging** from the **Help & Support** page. This lets you analyze queries that take a short time to run but happen very frequently. For Business Central online, additional logging is available on production environments running version 17.4 or later. For Business Central on-premises, additional logging is available on environments running version 18.6 or later.

> [!NOTE]
> With Business Central on-premises, you can change the threshold that defines long running queries. For more information, see [Defining Long Running SQL Queries Threshold](monitor-long-running-sql-queries-event-log.md#threshold).

There are multiple reasons that affect the time it takes SQL queries to run. For example, the database could be waiting for a lock to be released. Or, the database is executing an operation that does badly because of missing indexes. Sometimes you can look at the SQL statement that was generated by the code to see what caused the delay. This information is found in the **CustomDimension** data, specifically the **AL Stack Trace** column.


## <a name="LRSQLQuery"></a>Dimensions in Application Insights

This table explains the columns included in long running query events emitted to Application Insights. Bold text indicates that the value of the columns is a constant. Some columns are standard for Application Insights. These columns are indicated by *Application Insights*.

|Column|Description or value|
|---------|-----|
|timestamp|Specifies the date and time that the long running query event occurred, such as 2019-08-20T07:23:07.9996696Z|
|message|Version 16.1 and later:<br />**Operation exceeded time threshold (SQL query)**<br /><br />Before version 16.1:<br />**Action took longer than expected**|
|severityLevel|**2** (This level indicates a warning. Long running queries are always recorded as warnings)|
|itemType|**trace**|
|customDimensions|(see table that follows)|
|operation_Name|**Long Running Operation (SQL Query)**<br /><br />**Note:** The use of the `operation_Name` column was deprecated in version 16.1. In future versions, data won't be stored in this column. So in version 16.1 and later, use the custom dimension column `eventID` column custom in Kusto queries instead of `operation_Name`.|
|operation_Id|Specifies the GUID assigned to the client operation. An operation is created whenever the user does something in the client, such as selecting an action.|
|operation_ParentId|Currently this column is the same as the operation_Id. This behavior might change in a future release.|
|session_Id|Specifies the GUID of the client session. When a client makes a connection to the [!INCLUDE[server](../developer/includes/server.md)] instance, a session is created and assigned an ID. |
|client_Type|*Application Insights*|
|client_IP|*Application Insights*|
|client_City|*Application Insights*|
|client_StateOrProvince|*Application Insights*|
|client_CountryOrRegion|*Application Insights*|
|cloud_RoleName|Specifies the display name of [!INCLUDE[prod_short](../developer/includes/prod_short.md)] tenant. For on-premises, this value is the same as the cloud_RoleInstance.  |
|cloud_RoleInstance|Specifies the name of [!INCLUDE[prod_short](../developer/includes/prod_short.md)] tenant. |
|appId|*Application Insights*|
|appName|*Application Insights*|
|iKey|*Application Insights*|
|sdkVersion|*Application Insights*|
|user_Id|[!INCLUDE[user_Id](../includes/include-telemetry-user-id.md)] |


## CustomDimensions


<!-- 
```
{"telemetrySchemaVersion":"0.3","executionTimeInMs":"99","component":"Dynamics Business Central Server - 15.0.35274.0","environmentType":"Production","sqlStatement":"SELECT \"2161\".\"timestamp\",\"2161\".\"User\",\"2161\".\"Default Execute Time\",\"2161\".\"Current Job Queue Entry\",\"2161\".\"$systemId\" FROM \"SQLDATABASE\".dbo.\"CURRENTCOMPANY$Calendar Event User Config_\" \"2161\"  WITH(UPDLOCK)  WHERE (\"2161\".\"User\"=@0) OPTION(OPTIMIZE FOR UNKNOWN)","clientType":"Background","alStackTrace":"AppObjectType: CodeUnit\r\n  AppObjectId: 2160\r\n  AL CallStack: \"Calendar Event Management\"(CodeUnit 2160).GetCalendarEventUserConfiguration line 2\r\n\"Calendar Event Management\"(CodeUnit 2160).FindJobQueue line 1\r\n\"Calendar Event Execution\"(CodeUnit 2161).RunCalendarEvents line 20\r\n\"Calendar Event Execution\"(CodeUnit 2161).OnRun(Trigger) line 1\r\n\"Job Queue Start Codeunit\"(CodeUnit 449).OnRun(Trigger) line 6\r\n\"Job Queue Dispatcher\"(CodeUnit 448).HandleRequest line 18\r\n\"Job Queue Dispatcher\"(CodeUnit 448).OnRun(Trigger) line 12","alObjectName":"Calendar Event Management","alObjectType":"CodeUnit","companyName":"CRONUS International Ltd.","alObjectId":"2160"}
```

{"telemetrySchemaVersion":"0.3","executionTime":"00:00:01.5340000","deprecatedKeys":"Execution time (ms), Long running log threshold (ms), longRunningThresholdInMs, Company name, AL Object Id, AL Object type, AL Object name, AL Stack trace, Client type, Extension name, Extension App Id, SQL statement, AadTenantId, Environment name, Environment type, Component, Telemetry schema version","executionTimeInMs":"1534","AadTenantId":"nav-systemapplication","Environment type":"Production","sqlStatement":"SELECT CT.SYS_CHANGE_VERSION, 0[Change Type], CT.SYS_CHANGE_OPERATION, 0[Object Type], 0[Object ID], '00000000-0000-0000-0000-000000000000'[Runtime Package ID], ''[Tenant ID] FROM CHANGETABLE(CHANGES [Debugger Breakpoint], @maxChangeTrackingNumberDebuggerBreakpoint) CT\r\nUNION ALL\r\nSELECT CT.SYS_CHANGE_VERSION, 1[Change Type], CT.SYS_CHANGE_OPERATION, 0[Object Type], 0[Object ID], '00000000-0000-0000-0000-000000000000'[Runtime Package ID], ''[Tenant ID] FROM CHANGETABLE(CHANGES [dbo].[Add-in], @maxChangeTrackingNumberAddIn) CT WHERE CT.SYS_CHANGE_OPERATION = 'U'\r\nUNION ALL\r\nSELECT CT.SYS_CHANGE_VERSION, 2[Change Type], CT.SYS_CHANGE_OPERATION, 0[Object Type], 0[Object ID], CT.[Runtime Package ID], CT.[Tenant ID] FROM CHANGETABLE(CHANGES [dbo].[Installed Application], @maxChangeTrackingNumberInstalledApplication) CT\r\nUNION ALL\r\nSELECT CT.SYS_CHANGE_VERSION, 3[Change Type], CT.SYS_CHANGE_OPERATION, 0[Object Type], 0[Object ID], CT.[Runtime Package ID], ''[Tenant ID] FROM CHANGETABLE(CHANGES [dbo].[Published Application], @maxChangeTrackingNumberPublishedApplication) CT","SQL statement":"SELECT CT.SYS_CHANGE_VERSION, 0[Change Type], CT.SYS_CHANGE_OPERATION, 0[Object Type], 0[Object ID], '00000000-0000-0000-0000-000000000000'[Runtime Package ID], ''[Tenant ID] FROM CHANGETABLE(CHANGES [Debugger Breakpoint], @maxChangeTrackingNumberDebuggerBreakpoint) CT\r\nUNION ALL\r\nSELECT CT.SYS_CHANGE_VERSION, 1[Change Type], CT.SYS_CHANGE_OPERATION, 0[Object Type], 0[Object ID], '00000000-0000-0000-0000-000000000000'[Runtime Package ID], ''[Tenant ID] FROM CHANGETABLE(CHANGES [dbo].[Add-in], @maxChangeTrackingNumberAddIn) CT WHERE CT.SYS_CHANGE_OPERATION = 'U'\r\nUNION ALL\r\nSELECT CT.SYS_CHANGE_VERSION, 2[Change Type], CT.SYS_CHANGE_OPERATION, 0[Object Type], 0[Object ID], CT.[Runtime Package ID], CT.[Tenant ID] FROM CHANGETABLE(CHANGES [dbo].[Installed Application], @maxChangeTrackingNumberInstalledApplication) CT\r\nUNION ALL\r\nSELECT CT.SYS_CHANGE_VERSION, 3[Change Type], CT.SYS_CHANGE_OPERATION, 0[Object Type], 0[Object ID], CT.[Runtime Package ID], ''[Tenant ID] FROM CHANGETABLE(CHANGES [dbo].[Published Application], @maxChangeTrackingNumberPublishedApplication) CT","componentVersion":"15.0.40325.0","alObjectId":"0","Component":"Dynamics 365 Business Central Server","longRunningThreshold":"00:00:01","Execution time (ms)":"1534","AL Object Id":"0","Long running log threshold (ms)":"1000","Telemetry schema version":"0.3","Component version":"15.0.40325.0","longRunningThresholdInMs":"1000","environmentType":"Production","component":"Dynamics 365 Business Central Server","aadTenantId":"nav-systemapplication"}


{"extensionVersion":"16.0.10962.0","Telemetry schema version":"0.3","telemetrySchemaVersion":"0.3","Component version":"15.0.40494.0","Extension version":"16.0.10962.0","componentVersion":"15.0.40494.0","Extension App Id":"437dbf0e-84ff-417a-965d-ed2bb9650972","Environment name":"Production","Environment type":"Production","environmentType":"Production","environmentName":"Production","deprecatedKeys":"Execution time (ms), Long running log threshold (ms), longRunningThresholdInMs, Company name, AL Object Id, AL Object type, AL Object name, AL Stack trace, Client type, Extension name, Extension App Id, SQL statement, AadTenantId, Environment name, Environment type, Component, Telemetry schema version","AL Object type":"Report","Extension name":"Base Application","AL Stack trace":"AppObjectType: Report\r\n AppObjectId: 840\r\n AL CallStack: \"Suggest Worksheet Lines\"(Report 840).DeleteEntries line 10 - Base Application by Microsoft\r\n\"Suggest Worksheet Lines\"(Report 840).\"Cash Flow Forecast - OnPostDataItem\"(Trigger) line 5 - Base Application by Microsoft\r\n\"Cash Flow Management\"(CodeUnit 841).UpdateCashFlowForecast line 32 - Base Application by Microsoft\r\n\"Cash Flow Forecast Update\"(CodeUnit 842).OnRun(Trigger) line 18 - Base Application by Microsoft\r\n\"Job Queue Start Codeunit\"(CodeUnit 449).OnRun(Trigger) line 11 - Base Application by Microsoft\r\n\"Job Queue Dispatcher\"(CodeUnit 448).HandleRequest line 30 - Base Application by Microsoft\r\n\"Job Queue Dispatcher\"(CodeUnit 448).OnRun(Trigger) line 19 - Base Application by Microsoft","AL Object name":"Suggest Worksheet Lines","extensionName":"Base Application","alObjectType":"Report","AL Object Id":"840","Company name":"CRONUS USA, Inc.","alObjectName":"Suggest Worksheet Lines","alStackTrace":"AppObjectType: Report\r\n AppObjectId: 840\r\n AL CallStack: \"Suggest Worksheet Lines\"(Report 840).DeleteEntries line 10 - Base Application by Microsoft\r\n\"Suggest Worksheet Lines\"(Report 840).\"Cash Flow Forecast - OnPostDataItem\"(Trigger) line 5 - Base Application by Microsoft\r\n\"Cash Flow Management\"(CodeUnit 841).UpdateCashFlowForecast line 32 - Base Application by Microsoft\r\n\"Cash Flow Forecast Update\"(CodeUnit 842).OnRun(Trigger) line 18 - Base Application by Microsoft\r\n\"Job Queue Start Codeunit\"(CodeUnit 449).OnRun(Trigger) line 11 - Base Application by Microsoft\r\n\"Job Queue Dispatcher\"(CodeUnit 448).HandleRequest line 30 - Base Application by Microsoft\r\n\"Job Queue Dispatcher\"(CodeUnit 448).OnRun(Trigger) line 19 - Base Application by Microsoft","companyName":"CRONUS USA, Inc.","extensionId":"437dbf0e-84ff-417a-965d-ed2bb9650972","Client type":"Background","aadTenantId":"8ca62103-8877-486d-88e2-9a91303abfc6","AadTenantId":"8ca62103-8877-486d-88e2-9a91303abfc6","clientType":"Background","alObjectId":"840","Component":"Dynamics 365 Business Central Server","component":"Dynamics 365 Business Central Server","executionTimeInMs":"5747","SQL statement":"DELETE FROM \"SQLDATABASE\".dbo.\"CURRENTCOMPANY$Cash Flow Forecast Entry$437dbf0e-84ff-417a-965d-ed2bb9650972\" WHERE (\"Cash Flow Forecast No_\"=@0)","Long running log threshold (ms)":"1000","longRunningThreshold":"00:00:01","longRunningThresholdInMs":"1000","executionTime":"00:00:05.7470000","sqlStatement":"DELETE FROM \"SQLDATABASE\".dbo.\"CURRENTCOMPANY$Cash Flow Forecast Entry$437dbf0e-84ff-417a-965d-ed2bb9650972\" WHERE (\"Cash Flow Forecast No_\"=@0)","Execution time (ms)":"5747"}
-->

This table describes the different dimensions of a **Long Running Operation (SQL Query)** operation.

|Column (key)|Description or value|
|---------|-----|
|extensionVersion|Specifies the version of the extension.|
|telemetrySchemaVersion|Specifies the version of the [!INCLUDE[prod_short](../developer/includes/prod_short.md)] telemetry schema. |
|componentVersion|Specifies the version number of the component that emits telemetry (see the component dimension.)|
|environmentType|Specifies the environment type of the [!INCLUDE[prod_short](../developer/includes/prod_short.md)] solution, such as Production or Sandbox.|
|environmentName|Specifies the environment name of the [!INCLUDE[prod_short](../developer/includes/prod_short.md)] solution, such as Production or Sandbox.|
|extensionName|Specifies the name of the extension.|
|alObjectType|The type of the AL object that executed the SQL statement|
|alObjectName|The name of the AL object that executed the SQL statement|
|alStackTrace|The stack trace in AL.|
|companyName|The display name of the [!INCLUDE[prod_short](../developer/includes/prod_short.md)] company that was used at time of execution. |
|extensionId|Specifies the AppID of the extension.|
|eventId|**RT0005**<br /><br/>This dimension was introduced in Business Central 2020 release wave 1, version 16.1.|
|aadTenantId|Specifies the Microsoft Entra tenant ID when using Microsoft Entra authentication. For on-premises, if you aren't using Microsoft Entra authentication, this value is **common**. |
|clientType|Specifies the type of client that executed the SQL Statement, such as Background or Web. For a list of the client types, see [ClientType Option Type](../developer/methods-auto/clienttype/clienttype-option.md).|
|alObjectId|The type of the AL object that executed the SQL statement.|
|component|Specifies the [!INCLUDE[server](../developer/includes/server.md)] instance name and the platform version.|
|executionTime|Specifies the time that it took to execute the SQL statement**. The value has the format hh:mm:ss.sssssss.|
|longRunningThreshold|Specifies the amount of time that an SQL query can run before a warning event is recorded.  The value has the format hh:mm:ss.sssssss. <br /><br >This threshold is controlled by the [!INCLUDE[server](../developer/includes/server.md)] configuration setting called SqlLongRunningThreshold. |
|sqlStatement|Specifies the SQL statement that was executed for the long running query. The value is limited to 8192 characters. If the value exceeds 8192 characters, it will be truncated in manner that still provides the most pertinent information.|
|deprecatedKeys|A comma-separated list of all the keys that have been deprecated. The keys in this list are still supported but will eventually be removed in the next major release. We recommend that update any queries that use these keys to use the new key name.|

** From telemetrySchemaVersion **0.6** and onwards, this value also includes the CompanyOpen operation.

## Example

The following code snippet shows an example of the CustomDimensions.

`{"extensionVersion":"16.0.10962.0","telemetrySchemaVersion":"0.3","componentVersion":"15.0.40494.0","environmentType":"Production","environmentName":"Production","extensionName":"Base Application","alObjectType":"Report","alObjectName":"Suggest Worksheet Lines","alStackTrace":"AppObjectType: Report\r\n AppObjectId: 840\r\n AL CallStack: \"Suggest Worksheet Lines\"(Report 840).DeleteEntries line 10 - Base Application by Microsoft\r\n\"Suggest Worksheet Lines\"(Report 840).\"Cash Flow Forecast - OnPostDataItem\"(Trigger) line 5 - Base Application by Microsoft\r\n\"Cash Flow Management\"(CodeUnit 841).UpdateCashFlowForecast line 32 - Base Application by Microsoft\r\n\"Cash Flow Forecast Update\"(CodeUnit 842).OnRun(Trigger) line 18 - Base Application by Microsoft\r\n\"Job Queue Start Codeunit\"(CodeUnit 449).OnRun(Trigger) line 11 - Base Application by Microsoft\r\n\"Job Queue Dispatcher\"(CodeUnit 448).HandleRequest line 30 - Base Application by Microsoft\r\n\"Job Queue Dispatcher\"(CodeUnit 448).OnRun(Trigger) line 19 - Base Application by Microsoft","companyName":"CRONUS USA, Inc.","extensionId":"437dbf0e-84ff-417a-965d-ed2bb9650972","aadTenantId":"8ca62103-8877-486d-88e2-9a91303abfc6","clientType":"Background","alObjectId":"840","component":"Dynamics 365 Business Central Server","executionTime":"00:00:05.7470000","sqlStatement":"DELETE FROM \"SQLDATABASE\".dbo.\"CURRENTCOMPANY$Cash Flow Forecast Entry$437dbf0e-84ff-417a-965d-ed2bb9650972\" WHERE (\"Cash Flow Forecast No_\"=@0)"}`
 
## See also

[Monitoring and Analyzing Telemetry](telemetry-overview.md)  
[Enable Sending Telemetry to Application Insights](telemetry-enable-application-insights.md)  
[Monitoring and Analyzing Long Running SQL Queries On-Premises](monitor-long-running-sql-queries-event-log.md)  
[The Business Central Administration Center](tenant-admin-center.md)  
